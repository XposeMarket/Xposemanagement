<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Parts search test</title>
  <style>
    body { font-family: system-ui, Arial; padding: 20px; }
    .card { border:1px solid #ddd; padding:12px; margin:8px 0; border-radius:6px; }
    .card h3 { margin:0 0 6px 0; font-size:16px }
    .meta { color:#666; font-size:13px }
    .price { font-weight:700; color:#0a6 }
    .btn { padding:6px 10px; border-radius:4px; cursor:pointer; }
  </style>
</head>
<body>
  <h2>Parts search (Grok-only prototype)</h2>
  <form id="partsForm">
    <label>Year <input name="year" value="2016"></label>
    <label>Make <input name="make" value="Honda"></label>
    <label>Model <input name="model" value="Civic"></label>
    <label>Part <input name="part" value="alternator"></label>
    <button type="submit" class="btn">Search</button>
  </form>
  <div id="status"></div>
  <div id="results"></div>

  <script src="vendor/supabase.umd.js"></script>
  <script src="app.js"></script>
  <script src="multi-tenant.js"></script>
  <script>
    const form = document.getElementById('partsForm');
    const status = document.getElementById('status');
    const results = document.getElementById('results');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      results.innerHTML='';
      status.textContent = 'Searching...';
      const formData = new FormData(form);
      const body = {
        year: formData.get('year'),
        make: formData.get('make'),
        model: formData.get('model'),
        part: formData.get('part')
      };
      try {
        const r = await fetch('/search-parts', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        if (!r.ok) {
          const err = await r.json().catch(()=>({error: r.statusText}));
          status.textContent = 'Error: ' + (err.error || r.statusText);
          results.textContent = JSON.stringify(err, null, 2);
          return;
        }
        const data = await r.json();
        status.textContent = 'Found ' + (data.items ? data.items.length : 0) + ' items';
        (data.items || []).forEach(it => {
          const el = document.createElement('div'); el.className='card';
          el.innerHTML = `
            <h3><a href="${it.url}" target="_blank" rel="noopener">${it.title}</a></h3>
            <div class="meta">${it.source_domain} &middot; <span class="price">${it.estimated_price || ''}</span></div>
            <p>${it.snippet || ''}</p>
            <div class="meta">Part#: ${it.part_number || '—'} &nbsp; Confidence: ${it.confidence || '—'}</div>
          `;
          results.appendChild(el);
        });
      } catch (e) {
        status.textContent = 'Request failed';
        results.textContent = e.message || String(e);
      }
    });
  </script>
</body>
</html>