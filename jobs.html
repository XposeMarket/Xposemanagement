<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Jobs</title><link rel="stylesheet" href="styles.css"><link rel="stylesheet" href="components/supplierLinks.css"></head><body>
<header class="top">
  <div class="container row top row">
    <a class="brand" href="dashboard.html" aria-label="Home">
      <img id="headerLogo" src="assets/XposeManagementCRMlogo.png" alt="Logo">
    </a>
    <button id="menuToggle" class="menu-toggle" aria-label="Toggle menu"><span></span><span></span><span></span></button><nav id="mainNav">
      <a href="dashboard.html" class="">Dashboard</a>
      <a href="appointments.html" class="">Appointments</a>
      <a href="foreman-appointments.html" class="foreman-nav">Job Board</a>
      <a href="claim-board.html" class="foreman-nav">Claim Board</a>
      <a href="jobs.html" class="active">Jobs</a>
      <a href="messages.html" class="">Messages</a>
      <a href="invoices.html" class="">Invoices</a>
      <a href="customers.html" class="">Customers</a>
      <a href="revenue.html" class="">Revenue</a>
      <a href="settings.html" class="">Settings</a>
      <a href="profile.html" class="">Profile</a>
        <a href="#" id="mobileThemeToggle" class="mobile-nav-btn mobile-special">Theme</a>
        <a href="#" id="mobileLogoutBtn" class="mobile-nav-btn mobile-special">Logout</a>
    </nav>
    <div>
      <button id="themeToggle" class="btn" aria-label="Toggle theme">Theme</button>
      <button id="logoutBtn" class="btn" aria-label="Logout">Logout</button>
    </div>
  </div>
</header>
<div id="notification" class="notification hidden"></div>
<div id="errorBanner" class="notification hidden" style="background:#ef4444;color:white;"></div>
<!-- Error banner for user notifications (preserved) -->
<!-- Debug banner (hidden in UI) -->
<!-- ...existing code... -->
<main class="container" style="padding:16px 0"><h1>Jobs</h1>


<!-- Existing card (kept 1:1, just a heading added) -->
<div class="card">
  <h3>Active Jobs (In progress)</h3>
  <table class="table" id="jobsTable">
    <thead><tr>
      <th style="width: 20px; padding: 0;"></th>
      <th class="sortable" data-col="id">Job #</th>
      <th class="sortable" data-col="customer">Customer</th>
      <th class="sortable" data-col="vehicle">Vehicle</th>
      <th class="sortable" data-col="service">Service</th>
      <th class="sortable" data-col="status">Status</th>
      <th class="sortable" data-col="assigned">Assigned To</th>
      <th>Actions</th>
    </tr></thead>
    <tbody></tbody>
  </table>
  <p class="notice" id="jobsEmpty"></p>
</div>

<!-- New, second card (staff-only population handled by app.js) -->
<div class="card" id="awaitWrap" style="margin-top:16px">
  <h3>Awaiting Parts</h3>
  <table class="table" id="awaitTable">
    <thead><tr>
      <th style="width: 20px; padding: 0;"></th>
      <th class="sortable" data-col="id">Job #</th>
      <th class="sortable" data-col="customer">Customer</th>
      <th class="sortable" data-col="vehicle">Vehicle</th>
      <th class="sortable" data-col="service">Service</th>
      <th class="sortable" data-col="status">Status</th>
      <th class="sortable" data-col="assigned">Assigned To</th>
      <th>Actions</th>
    </tr></thead>
    <tbody></tbody>
  </table>
  <p class="notice" id="awaitEmpty"></p>
</div>



<!-- Add Parts Modal -->
<div id="addPartsModal" class="card hidden" style="position:fixed; right:20px; bottom:20px; max-width:680px; z-index:65">
  <form id="addPartsForm" onsubmit="return false;">
    <div class="toolbar" style="justify-content:space-between">
      <h3>Add Parts</h3>
      <button id="closeAddParts" class="btn">Close</button>
    </div>
    <div class="grid cols-2" style="margin-top:8px">
      <div>
        <label>Part Name</label>
        <input id="partName" placeholder="e.g., Brake Pads">
      </div>
      <div>
        <label>Quantity</label>
        <input id="partQty" type="number" value="1" min="1">
      </div>
      <div>
        <label>Price</label>
        <input id="partPrice" type="number" step="0.01" placeholder="0.00">
      </div>
    </div>
      <div class="toolbar" style="margin-top:8px; justify-content:flex-end">
      <button id="addToInvoiceBtn" class="btn info" type="button">Add to Invoice</button>
    </div>
    <p class="notice" id="addPartsNote"></p>
  </form>
</div>

<!-- Labor Modal (single unified modal used by jobs and parts flows) -->
<!-- Labor Modal - overlay added and forced fixed positioning to avoid CSS overrides -->
<div id="laborModalOverlay" class="modal-overlay" style="display:none; z-index:200000; background:rgba(0,0,0,0.25);"></div>
<div id="laborModal" class="card hidden" style="position:fixed !important; top:50% !important; left:50% !important; transform:translate(-50%,-50%) !important; max-width:500px; width:90%; max-height:90vh; overflow-y:auto; z-index:200001 !important; box-shadow:0 20px 60px rgba(0,0,0,0.3); margin:0;">
  <div class="toolbar" style="justify-content:space-between">
    <h3>Add Labor</h3>
    <button id="labClose" class="btn">Close</button>
  </div>

  <div class="grid cols-2" style="margin-top:8px">
    <div>
      <label>Labor Description</label>
      <input id="labDesc" placeholder="e.g., Brake Pad Replacement">
      <!-- rate selector moved here (shows labor rate presets) -->
      <select id="labRateSel" class="form-control" style="margin-top:6px; width:100%;"></select>
    </div>
    <div>
      <label>Hours</label>
      <input id="labHours" type="number" min="0" step="0.1" value="1">
    </div>
    <div>
      <label>Rate</label>
      <input id="labRateCustom" type="number" step="0.01" placeholder="$/hr" style="margin-top:6px; width:100%;">
    </div>
  </div>

  <div class="toolbar" style="margin-top:8px; justify-content:flex-end">
    <button id="labConfirm" class="btn info">Add</button>
    <button id="skipLaborBtn" class="btn">Skip Labor</button>
  </div>
  <p class="notice" id="labNote" class="notice"></p>
</div>

<!-- Parts Modal Overlay -->
<div id="partsModalOverlay" class="modal-overlay" style="display:none; z-index:59;"></div>

<!-- Parts Finder Modal (integrated with catalog) -->
<div id="partsModal" class="card hidden" style="position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); max-width:800px; width:95%; z-index:60; max-height:95vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,0.3);">
  <div class="toolbar" style="justify-content:space-between">
    <h3 style="display: inline-block; margin: 0;">Find Parts</h3>
    <span style="font-size: 0.7rem; color: var(--muted); margin-left: 1rem;">
      <strong>Disclaimer:</strong> General catalog only. Fitment/availability not guaranteed. Call supplier for accurate info.
    </span>
    <button id="closeParts" class="btn">Close</button>
  </div>
  
  <!-- Vehicle Info Display -->
  <div id="partsVehicleInfo" style="background: var(--card-bg); padding: 12px; border-radius: 8px; margin-bottom: 16px; border: 1px solid var(--line);">
    <strong>Vehicle:</strong> <span id="partsCurrentVehicle">Loading...</span>
  </div>

  <!-- Supplier Quick Links Section (populated by supplierLinks.js) -->
  <div id="supplierQuickLinks" style="margin-bottom: 2px;">
    <div class="supplier-links-container">
      <!-- Supplier links will be populated by JavaScript -->
    </div>
  </div>

  <!-- Inventory Results Section -->
  <div id="inventoryResultsSection">
    <div id="catalogResults" style="margin-top: 2px; max-height: 400px; overflow-y: auto;">
      <p class="notice" style="text-align: center; color: var(--muted); padding: 2rem 1rem;">
        <strong style="display: block; margin-bottom: 0.5rem;">Loading inventory...</strong>
        <small style="color: var(--muted); font-size: 0.85rem;">ðŸ’¡ Your shop's inventory items will appear here</small>
      </p>
    </div>
  </div>

  <!-- Manual Entry Fallback -->
  <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--line); display:flex; gap:8px;">
    <button id="openAddPartsFromFinder" class="btn" style="flex:1;">Add Parts Manually</button>
    <button id="openInventoryPartsFromFinder" class="btn" style="flex:1;">Add Part from Inventory</button>
    <button id="openAddServiceFromFinder" class="btn" style="flex:1;">Add Service</button>
  </div>
</div>

</main>

<div id="jobViewModal" class="modal-overlay hidden" onclick="closeJobViewModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-head">
      <h3>Appointment Details</h3>
      <button onclick="closeJobViewModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body" id="jobViewContent">
      <!-- content will be populated -->
    </div>
    <div class="modal-foot">
      <button onclick="closeJobViewModal()" class="btn">Close</button>
    </div>
  </div>
</div>

<div id="jobNoteModal" class="modal-overlay hidden" onclick="closeJobNoteModal()" style="z-index: 10030;">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 600px;">
    <div class="modal-head">
      <h3 id="jobNoteModalTitle">Add Note</h3>
      <button onclick="closeJobNoteModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <form id="jobNoteForm" style="display: flex; flex-direction: column; gap: 12px;">
        <label for="jobNoteText">Note:</label>
        <textarea id="jobNoteText" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;" placeholder="Enter your note here..."></textarea>
        
        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label>Attachments (Images/Videos):</label>
          <div style="display: flex; align-items: center; gap: 12px;">
            <label for="jobNoteMedia" class="btn small" style="cursor: pointer; margin: 0;">
              Choose Files
            </label>
            <input type="file" id="jobNoteMedia" accept="image/*,video/*" multiple style="display: none;" onchange="handleNoteMediaSelect(this)">
            <span id="jobNoteMediaCount" style="font-size: 13px; color: #666;">No files selected</span>
          </div>
          <div id="jobNoteMediaPreview" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 4px;"></div>
        </div>
      </form>
    </div>
    <div class="modal-foot">
      <button onclick="closeJobNoteModal()" class="btn">Cancel</button>
      <button onclick="saveJobNote(event)" class="btn info" id="saveJobNoteBtn">Save</button>
    </div>
  </div>
</div>

<!-- Media Preview Modal -->
<div id="mediaPreviewModal" class="modal-overlay hidden" onclick="closeMediaPreview()" style="z-index: 10050;">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 90vw; max-height: 90vh; padding: 0; background: #000; border-radius: 8px; overflow: hidden;">
    <button onclick="closeMediaPreview()" class="btn-close" style="position: absolute; top: 10px; right: 10px; z-index: 10; background: rgba(0,0,0,0.5); color: white; border-radius: 50%; width: 36px; height: 36px;">&times;</button>
    <div id="mediaPreviewContent" style="display: flex; justify-content: center; align-items: center; max-height: 85vh;"></div>
  </div>
</div>

<!-- Delete Note Confirmation Modal -->
<div id="deleteNoteModal" class="modal-overlay hidden" onclick="closeDeleteNoteModal()" style="z-index: 10040;">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 400px;">
    <div class="modal-head">
      <h3>Delete Note</h3>
      <button onclick="closeDeleteNoteModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this note? This action cannot be undone.</p>
    </div>
    <div class="modal-foot">
      <button onclick="closeDeleteNoteModal()" class="btn">Cancel</button>
      <button onclick="confirmDeleteNote()" class="btn danger">Delete</button>
    </div>
  </div>
</div>

<div id="statusModal" class="modal-overlay hidden" onclick="closeStatusModal()">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 400px;">
    <div class="modal-head">
      <h3>Select Status</h3>
      <button onclick="closeStatusModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <div id="statusPills" style="display: flex; flex-direction: column; gap: 12px;">
        <!-- Pills will be populated -->
      </div>
    </div>
  </div>
</div>

<div id="removeModal" class="modal-overlay hidden" onclick="closeRemoveModal()">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 400px;">
    <div class="modal-head">
      <h3>Remove Job</h3>
      <button onclick="closeRemoveModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to remove this job?</p>
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 20px;">
        <button id="removeJobBtn" class="btn danger" style="width: 100%;">Remove Job</button>
        <button id="removeJobApptBtn" class="btn danger" style="width: 100%;">Remove Job & Appointment</button>
        <button id="cancelRemoveBtn" class="btn" style="width: 100%;">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Parts Catalog Modals (container placeholder - renamed to avoid global collision with modal script) -->
<div id="partPricingModalContainer"></div>

<!-- Service Selection Modal -->
<div id="serviceModal" class="modal-overlay hidden" onclick="closeServiceModal()" style="z-index: 10040;">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 500px;">
    <div class="modal-head">
      <h3>Add Additional Service</h3>
      <button onclick="closeServiceModal()" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom: 20px;">
        <p style="color: var(--muted); font-size: 0.9rem; margin-bottom: 12px;">Select a service to add to this job:</p>
        <div id="serviceOptionsContainer" style="display: flex; flex-direction: column; gap: 8px;">
          <!-- Service options will be populated here -->
        </div>
        <div style="margin-top:12px;border-top:1px solid var(--line);padding-top:12px;display:flex;gap:8px;align-items:center;">
          <input id="otherServiceInput" placeholder="Other service name" style="flex:1;padding:8px;border:1px solid var(--line);border-radius:6px;">
          <input id="otherServiceRate" type="number" step="0.01" placeholder="Rate" style="width:110px;padding:8px;border:1px solid var(--line);border-radius:6px;">
          <button id="otherServiceConfirm" class="btn info" type="button" title="Add">âœ“</button>
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <button onclick="closeServiceModal()" class="btn">Cancel</button>
      <button id="addNewServiceBtn" class="btn info" type="button">Add New Service</button>
    </div>
  </div>
</div>

<!-- New Service Modal: enter name & rate -->
<div id="newServiceModal" class="modal-overlay hidden" onclick="document.getElementById('newServiceModal').classList.add('hidden')">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width:420px;">
    <div class="modal-head">
      <h3>Add New Service</h3>
      <button onclick="document.getElementById('newServiceModal').classList.add('hidden')" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display:flex;flex-direction:column;gap:12px;">
        <label>Service Name</label>
        <input id="newServiceName" placeholder="e.g., Brake Pad Replacement">
        <label>Rate</label>
        <input id="newServiceRate" type="number" step="0.01" placeholder="0.00">
      </div>
    </div>
    <div class="modal-foot">
      <button onclick="closeNewServiceModal()" class="btn">Cancel</button>
      <button id="confirmAddServiceBtn" class="btn info" type="button">Add</button>
    </div>
  </div>
</div>

<!-- Service Add Flow Modal: choose next step -->
<div id="serviceAddFlowModal" class="modal-overlay hidden" onclick="document.getElementById('serviceAddFlowModal').classList.add('hidden')">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width:480px;">
    <div class="modal-head">
      <h3>Customize Service</h3>
      <button onclick="document.getElementById('serviceAddFlowModal').classList.add('hidden')" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <p style="color:var(--muted);">Choose what to do next for this service:</p>
      <div style="display:flex;flex-direction:column;gap:10px;margin-top:12px;">
        <button id="addPartsToServiceBtn" class="btn">Add Parts to Service</button>
        <button id="addLaborToServiceBtn" class="btn">Add Labor to Service</button>
        <button id="skipToInvoiceBtn" class="btn info">Skip & Add to Invoice</button>
      </div>
    </div>
  </div>
</div>

<!-- Save Service Confirm Modal -->
<div id="saveServiceConfirmModal" class="modal-overlay hidden" onclick="document.getElementById('saveServiceConfirmModal').classList.add('hidden')" style="z-index:100050;">
  <div class="modal-content" onclick="event.stopPropagation()" style="max-width:360px;">
    <div class="modal-head">
      <h3>Save Service?</h3>
      <button onclick="document.getElementById('saveServiceConfirmModal').classList.add('hidden')" class="btn-close">&times;</button>
    </div>
    <div class="modal-body">
      <p>Save this service to shop settings for later use?</p>
    </div>
    <div class="modal-foot">
      <button id="saveServiceNoBtn" class="btn">No</button>
      <button id="saveServiceYesBtn" class="btn info">Yes</button>
    </div>
  </div>
</div>

<footer class="container">Â© Xpose Market</footer>
<script src="vendor/supabase.umd.js"></script>
<script type="module" src="app.js"></script>
<script src="multi-tenant.js"></script>
<!-- Parts Catalog Components -->
<script type="module" src="pages/jobs.js"></script>
<script src="components/partsCatalogModal.js"></script>
<script src="components/partPricingModal.js"></script>
<script src="components/partsModalHandler.js"></script>
<!-- Supplier Links Component -->
<script src="components/supplierLinks.js"></script>

</body></html>
