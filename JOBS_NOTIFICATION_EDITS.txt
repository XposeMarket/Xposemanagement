JOBS.JS QUICK EDITS - COPY/PASTE THESE 4 SECTIONS:

====================
EDIT #1: Line 14 - Add import
====================
FIND THIS LINE:
import { saveAppointments } from './appointments.js';

ADD THIS LINE AFTER IT:
import { createShopNotification } from '../helpers/shop-notifications.js';

====================
EDIT #2: After line 55 (after getCurrentUser function) - Add new function
====================
ADD THIS ENTIRE FUNCTION:

/**
 * Get current authenticated user's ID
 */
async function getCurrentAuthId() {
  const supabase = getSupabaseClient();
  if (!supabase) return null;
  
  try {
    const { data: authData } = await supabase.auth.getUser();
    return authData?.user?.id || null;
  } catch (error) {
    console.error('[Jobs] Error getting auth ID:', error);
    return null;
  }
}

====================
EDIT #3: In assignJob function - Add notification code at the END
====================
FIND THIS:
  const user = allUsers.find(u => u.id === userId);
  showNotification(`Job assigned to ${user.first} ${user.last}`);
}

REPLACE WITH:
  const user = allUsers.find(u => u.id === userId);
  showNotification(`Job assigned to ${user.first} ${user.last}`);
  
  // Create notification for assigned technician
  try {
    const shopId = getCurrentShopId();
    const authId = await getCurrentAuthId();
    const job = allJobs[index];
    const appt = allAppointments.find(a => a.id === job.appointment_id);
    
    await createShopNotification({
      supabase: getSupabaseClient(),
      shopId,
      type: 'job_assigned',
      category: 'job',
      title: 'New Job Assigned',
      message: `You have been assigned to work on ${appt?.customer || 'a customer'}'s ${appt?.vehicle || 'vehicle'} - ${appt?.service || 'Service request'}`,
      relatedId: job.id,
      relatedType: 'job',
      metadata: {
        customer_name: appt?.customer || '',
        vehicle: appt?.vehicle || '',
        service: appt?.service || '',
        job_id: job.id
      },
      priority: 'high',
      createdBy: authId,
      recipientUserId: userId
    });
  } catch (error) {
    console.error('[Jobs] Error creating assignment notification:', error);
  }
}

====================
EDIT #4: In updateJobStatus function - Add notification BEFORE saveJobs
====================
FIND THIS:
  await saveJobs(allJobs);
  renderJobs();
  showNotification(`Job status updated to ${newStatus.replace(/_/g, ' ')}`);
}

REPLACE WITH:
  // Create notification for status changes
  if (newStatus === 'awaiting_parts' || newStatus === 'completed') {
    try {
      const shopId = getCurrentShopId();
      const authId = await getCurrentAuthId();
      const job = allJobs[index];
      const appt = allAppointments.find(a => a.id === job.appointment_id);
      
      const titles = {
        'awaiting_parts': 'Job Awaiting Parts',
        'completed': 'Job Completed'
      };
      
      const messages = {
        'awaiting_parts': `Job for ${appt?.customer || 'customer'}'s ${appt?.vehicle || 'vehicle'} is awaiting parts. Review parts needed and place order.`,
        'completed': `Job for ${appt?.customer || 'customer'}'s ${appt?.vehicle || 'vehicle'} has been completed and is ready for invoicing.`
      };
      
      await createShopNotification({
        supabase: getSupabaseClient(),
        shopId,
        type: `job_${newStatus}`,
        category: 'job',
        title: titles[newStatus],
        message: messages[newStatus],
        relatedId: job.id,
        relatedType: 'job',
        metadata: {
          customer_name: appt?.customer || '',
          vehicle: appt?.vehicle || '',
          service: appt?.service || '',
          job_id: job.id,
          old_status: job.status,
          new_status: newStatus
        },
        priority: newStatus === 'awaiting_parts' ? 'high' : 'normal',
        createdBy: authId
      });
    } catch (error) {
      console.error('[Jobs] Error creating status notification:', error);
    }
  }
  
  await saveJobs(allJobs);
  renderJobs();
  showNotification(`Job status updated to ${newStatus.replace(/_/g, ' ')}`);
}

====================
DONE! Just 4 copy/paste edits!
====================
