<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Xpose Management - Pricing</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* ...existing styles... */
    @media (max-width: 700px) {
      .terminal-modal-options {
        display: flex !important;
        flex-direction: column !important;
        gap: 80px !important;
        max-height: 60vh !important;
        overflow-y: auto !important;
        padding-right: 4px !important;
      }
      .terminal-modal-options .terminal-option {
        margin-bottom: 64px !important;
        box-shadow: 0 2px 12px 0 rgba(0,0,0,0.07) !important;
      }
      .modal-content.card {
        padding: 10px !important;
        max-width: 98vw !important;
      }
      .terminal-modal-options img {
        max-width: 90vw !important;
      }
    }
  </style>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    .header {
      z-index: 100;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(42,124,255,0.04);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.9);
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      color: #2a7cff;
      text-decoration: none;
    }
    .header-nav {
      display: flex;
      align-items: center;
      gap: 28px;
      font-size: 1.08rem;
    }
    .header-nav a {
      color: #222;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .header-nav a:hover {
      color: #2a7cff;
    }
    .header-actions {
      display: flex;
      gap: 12px;
    }
    .btn-secondary {
      background: #fff;
      color: #2a7cff;
      border: 1.5px solid #e0e7ff;
      border-radius: 7px;
      padding: 12px 32px;
      font-size: 1.08rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(42,124,255,0.07);
      transition: border 0.2s;
    }
    .btn-secondary:hover {
      border-color: #2a7cff;
    }
    .pricing-main {
      max-width: 1100px;
      margin: 48px auto 0 auto;
      padding: 0 16px;
      padding-top: 100px; /* Account for fixed header */
    }
    .pricing-title {
      font-size: 2.5rem;
      font-weight: 800;
      text-align: center;
      margin-bottom: 18px;
    }
    .pricing-desc {
      text-align: center;
      color: #4a5a6a;
      font-size: 1.18rem;
      margin-bottom: 38px;
    }
    .pricing-row {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
      gap: 32px;
      margin-bottom: 32px;
    }
    .pricing-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 32px 24px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .pricing-card.popular {
      border: 2px solid #2a7cff;
    }
    .pricing-card h3 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: #2a7cff;
    }
    .pricing-card .plan-type {
      color: #888;
      font-size: 1.05rem;
      margin-bottom: 6px;
    }
    .pricing-card .plan-price {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 8px;
    }
    .pricing-card ul {
      list-style: disc inside;
      padding: 0 0 0 18px;
      margin: 0 0 18px 0;
      color: #888;
      font-size: 1rem;
      text-align: left;
    }
    .pricing-card .popular-badge {
      background: #eaf3ff;
      color: #2a7cff;
      font-size: 0.95rem;
      padding: 2px 10px;
      border-radius: 12px;
      margin-left: 8px;
      font-weight: 600;
      display: inline-block;
    }
    .pricing-card .coming-soon-badge {
      background: #ffeaa7;
      color: #d63031;
      font-size: 0.95rem;
      padding: 2px 10px;
      border-radius: 12px;
      margin-left: 8px;
      font-weight: 600;
      display: inline-block;
    }
    .pricing-card.disabled {
      opacity: 0.7;
      position: relative;
    }
    .pricing-card.disabled::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 14px;
      pointer-events: none;
    }
    .pricing-card.disabled .plan-btn {
      background: #ccc;
      cursor: not-allowed;
      pointer-events: none;
    }
    .pricing-card .plan-btn {
      margin: 0 auto;
      display: inline-block;
      background: #2a7cff;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 12px 32px;
      font-size: 1.08rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(42,124,255,0.10);
      transition: background 0.2s;
    }
    .pricing-card .plan-btn:hover {
      background: #195bb5;
    }
    .footer {
      margin-top: 80px;
      background: #f6f8ff;
      padding: 32px 0 16px 0;
      text-align: center;
      color: #7f5fff;
      font-size: 1.08rem;
    }
    .trial-note {
      text-align: center;
      color: #888;
      font-size: 1rem;
      margin-top: 32px;
    }
  </style>

</head>
<body>
  <header class="header">
    <a href="index.html" class="header-logo">
      <img src="assets/XposeManagementCRMlogo.png" alt="CRM Official Logo" style="height:54px;vertical-align:middle;">
    </a>
    <nav class="header-nav">
      <a href="index.html">Home</a>
      <a href="features.html">Features</a>
      <a href="paywall.html">Pricing</a>
    </nav>
    <div class="header-actions">
      <a href="login.html"><button class="btn-secondary">Sign In</button></a>
    </div>
  </header>
  <main class="pricing-main">
    <div class="pricing-title">Choose Your Plan</div>
    <div class="pricing-desc">Simple, transparent pricing. Start with a 14-day free trial. Cancel anytime.</div>
      <div class="pricing-desc" style="font-size:1.08rem;color:#2a7cff;margin-bottom:8px;">All plans include a free Stripe M2 terminal with optional upgrades.</div>
      <div class="pricing-desc" style="font-size:1.02rem;color:#666;margin-bottom:28px;">Terminals will ship within 5-7 Business Days of shop creation.</div>
    <div class="pricing-row">
      <div class="pricing-card">
        <h3>Single <span class="popular-badge">Available Now</span></h3>
        <div class="plan-type">1 Shop</div>
        <div style="font-size:2rem;font-weight:800;color:#dc2626;margin-bottom:4px;">$99</div>
        <div style="font-size:1.5rem;font-weight:700;margin-bottom:8px;">
          <span style="color:#000;text-decoration:line-through;text-decoration-color:#dc2626;text-decoration-thickness:3px;font-family:'Brush Script MT',cursive;">$129</span>
          <span style="font-size:1rem;font-weight:400;color:#000;"> /month</span>
        </div>
        <ul>
          <li>All core features</li>
        </ul>
        <button class="plan-btn">Start Single</button>
      </div>
      <div class="pricing-card popular">
        <h3>Local <span class="popular-badge">Most Popular</span></h3>
        <div class="plan-type">1-3 Shops</div>
        <div style="font-size:2rem;font-weight:800;color:#dc2626;margin-bottom:4px;">$149</div>
        <div style="font-size:1.5rem;font-weight:700;margin-bottom:8px;">
          <span style="color:#000;text-decoration:line-through;text-decoration-color:#dc2626;text-decoration-thickness:3px;font-family:'Brush Script MT',cursive;">$199</span>
          <span style="font-size:1rem;font-weight:400;color:#000;"> /month</span>
        </div>
        <ul>
          <li>All Core features</li>
          <li>Multi-shop management</li>
          <li><strong>1 month free Messaging</strong></li>
        </ul>
        <button class="plan-btn">Select Local</button>
      </div>
      <div class="pricing-card">
        <h3>Multi</h3>
        <div class="plan-type">1-6 Shops</div>
        <div style="font-size:2rem;font-weight:800;color:#dc2626;margin-bottom:4px;">$199</div>
        <div style="font-size:1.5rem;font-weight:700;margin-bottom:8px;">
          <span style="color:#000;text-decoration:line-through;text-decoration-color:#dc2626;text-decoration-thickness:3px;font-family:'Brush Script MT',cursive;">$250</span>
          <span style="font-size:1rem;font-weight:400;color:#000;"> /month</span>
        </div>
        <ul>
          <li>All Core features</li>
          <li>Advanced multi-shop tools</li>
          <li>First to receive all updates (Beta Testings included)</li>
          <li><strong>1 month free Messaging</strong></li>
        </ul>
        <button class="plan-btn">Select Multi</button>
      </div>
    </div>
    <div class="trial-note">All plans come with a 14-day free trial. Cancel anytime free of charge.</div>
  </main>


  <!-- Terminal selection modal -->
  <div id="terminalModal" class="modal-overlay hidden">
    <div class="modal-content card" style="max-width:1100px; width:95%; margin:6vh auto; padding:20px;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
        <h3 style="margin:0">Choose Your Terminal for <span id="terminalModalPlan"></span></h3>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="terminalModalConfirm" class="btn btn-primary">Confirm & Checkout</button>
          <button id="terminalModalClose" class="btn" aria-label="Close modal">×</button>
        </div>
      </div>
      <div style="margin-top:12px;text-align:center;">
        <button id="terminalOptOut" class="btn" style="background:#dc2626;color:#fff;font-size:0.95rem;padding:10px 20px;font-weight:600;line-height:1.4;">
          Opt out - I have my own terminal<br>
          <span style="font-size:0.85rem;opacity:0.9;">(Start using immediately)</span>
        </button>
      </div>
      <p style="color:#666;margin-top:8px;">All subscriptions include a Stripe Reader M2 by default — choose a different terminal to add its monthly fee.</p>
      <p style="color:#9ca3af;margin-top:6px;font-weight:600;">Terminal subscription payments will automatically end after 6 months.</p>
      <div id="terminalModalOptions" style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-top:14px;align-items:stretch;">
        <div class="terminal-option selected" data-terminal="reader_m2" style="padding:16px;border-radius:10px;background:#fff;text-align:center;display:flex;flex-direction:column;justify-content:space-between;">
          <img src="assets/Stripe Reader M2.png" alt="Reader M2" style="max-width:140px;margin-bottom:8px;">
          <h4 style="margin:6px 0">Stripe Reader M2</h4>
          <div style="color:#059669;font-weight:700;margin-bottom:8px;">Included FREE</div>
          <p style="color:#666;font-size:0.95rem;">Countertop terminal, no screen.</p>
          <div style="margin-top:10px"><button class="btn" onclick="selectTerminal('reader_m2')">Select</button></div>
        </div>

        <div class="terminal-option" data-terminal="wisepos_e" style="padding:16px;border-radius:10px;background:#fff;text-align:center;display:flex;flex-direction:column;justify-content:space-between;">
          <img src="assets/BBPOS WisePOS E1.png" alt="WisePOS E" style="max-width:140px;margin-bottom:8px;">
          <h4 style="margin:6px 0">BBPOS WisePOS E</h4>
          <div style="color:#b45309;font-weight:700;margin-bottom:8px;">+$30 / month for 6 months</div>
          <p style="color:#666;font-size:0.95rem;">Handheld terminal with touchscreen.</p>
          <div style="margin-top:10px"><button class="btn" onclick="selectTerminal('wisepos_e')">Select</button></div>
        </div>

        <div class="terminal-option" data-terminal="reader_s700" style="padding:16px;border-radius:10px;background:#fff;text-align:center;display:flex;flex-direction:column;justify-content:space-between;">
          <img src="assets/Stripe Reader S7001.png" alt="Reader S700" style="max-width:140px;margin-bottom:8px;">
          <h4 style="margin:6px 0;display:flex;align-items:center;justify-content:center;gap:8px;">
            Stripe Reader S700
            <span style="background:#eaf3ff;color:#2a7cff;font-size:0.95rem;padding:2px 10px;border-radius:12px;font-weight:600;">Most Popular</span>
          </h4>
          <div style="color:#9b1238;font-weight:700;margin-bottom:8px;">+$50 / month for 6 months</div>
          <p style="color:#666;font-size:0.95rem;">Premium terminal with customer-facing display.</p>
          <div style="margin-top:10px"><button class="btn" onclick="selectTerminal('reader_s700')">Select</button></div>
        </div>
      </div>

      
      <style>
        .modal-overlay { position:fixed; left:0; right:0; top:0; bottom:0; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; z-index:1200; padding: 20px; }
        .modal-overlay.hidden { display:none; }
        .modal-content { max-height: 86vh; overflow-y: auto; box-sizing: border-box; }
        .terminal-option { border:1px solid #e6eefc; border-radius:10px; }
        .terminal-option.selected {
          border:3px solid #2a7cff;
          background: #fff;
          box-shadow: 0 2px 12px rgba(42,124,255,0.10);
        }
        #terminalModalOptions { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; align-items: stretch; }
        #terminalModalOptions img { max-width:160px; height:auto; display:block; margin:0 auto 8px; }
        #terminalModalOptions .terminal-option { min-height:260px; display:flex; flex-direction:column; justify-content:space-between; gap:10px; padding:14px; box-sizing:border-box; align-items:flex-start; }
        #terminalModalOptions .terminal-option h4 { margin: 6px 0; }
        #terminalModalOptions .terminal-option p { margin: 6px 0 12px 0; color: #666; }
        /* Style the select buttons inside modal to match site buttons */
        #terminalModalOptions .btn,
        #terminalModal .btn {
          background: #2a7cff;
          color: #fff;
          border: none;
          border-radius: 7px;
          padding: 10px 18px;
          font-weight: 600;
          cursor: pointer;
        }
        #terminalModal .btn:hover { background: #195bb5; }

        /* Responsive: stack options on small screens, increase spacing and make images smaller */
        @media (max-width:900px) {
          #terminalModalOptions { grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:14px; }
        }
        @media (max-width:700px) {
          /* Force stacked panels: one per row */
          #terminalModalOptions { grid-template-columns: 1fr !important; gap:22px !important; }
          #terminalModalOptions img { max-width:120px; }
          .modal-content { width: 100%; margin: 0 8px; }
          .terminal-option { padding: 16px; }
          /* Make the select button full-width and larger for touch */
          #terminalModalOptions .btn { width: 100%; padding: 12px 14px; font-size: 1rem; }
        }
      </style>
    </div>
  </div>
  <footer class="footer" style="background:#f6f8ff;padding:32px 0 16px 0;text-align:center;color:#7f5fff;font-size:1.08rem;">
    <span>© 2025 Xpose Management</span>
    <div style="margin-top:18px;font-size:1.08rem;">
      <a href="faq.html" style="margin-right:18px;color:#2a7cff;font-weight:600;">FAQ</a>
      <a href="privacy.html" style="margin-right:18px;color:#2a7cff;font-weight:600;">Privacy Policy</a>
      <a href="terms.html" style="margin-right:18px;color:#2a7cff;font-weight:600;">Terms of Service</a>
      <a href="contact.html" style="color:#2a7cff;font-weight:600;">Contact/Support</a>
    </div>
  </footer>
  
  <script>
    // Stripe Price IDs - These are your actual Price IDs from Stripe Dashboard
    const PRICE_IDS = {
      single: 'price_1SX97Z4K55W1qqBCSwzYlDd6',
      local: 'price_1SX97b4K55W1qqBC7o7fJYUi',
      multi: 'price_1SX97d4K55W1qqBCcNM0eP00'
    };

    // Get user email if logged in
    function getUserEmail() {
      try {
        const session = JSON.parse(localStorage.getItem('xm_session') || '{}');
        const email = session.email || null;
        if (email && email.includes('@') && email.includes('.')) {
          return email;
        }
        return null;
      } catch (e) {
        return null;
      }
    }

    // Modal state
    let selectedPlan = null;
    let selectedTerminal = 'reader_m2';

    // Select terminal option
    window.selectTerminal = function(terminal) {
      selectedTerminal = terminal;
      document.querySelectorAll('.terminal-option').forEach(opt => {
        opt.classList.remove('selected');
        if (opt.dataset.terminal === terminal) opt.classList.add('selected');
      });
    };

    // Show modal for plan selection
    function showTerminalModal(planName) {
      selectedPlan = planName;
      selectedTerminal = 'reader_m2';
      document.getElementById('terminalModalPlan').textContent = planName.charAt(0).toUpperCase() + planName.slice(1);
      document.getElementById('terminalModal').classList.remove('hidden');
      selectTerminal('reader_m2');
    }

    // Hide modal
    document.getElementById('terminalModalClose').onclick = function() {
      document.getElementById('terminalModal').classList.add('hidden');
    };

    // Plan button click handler
    document.querySelectorAll('.plan-btn').forEach((btn, index) => {
      btn.addEventListener('click', () => {
        let planName;
        if (index === 0) planName = 'single';
        else if (index === 1) planName = 'local';
        else if (index === 2) planName = 'multi';
        showTerminalModal(planName);
      });
    });

    // Confirm & Checkout from modal
    document.getElementById('terminalModalConfirm').onclick = async function() {
      const plan = selectedPlan;
      const terminal = selectedTerminal;
      if (!plan || !terminal) {
        alert('Please select a plan and terminal.');
        return;
      }
      const priceId = PRICE_IDS[plan];
      if (!priceId || priceId.includes('REPLACE')) {
        alert('Stripe is not configured yet. Please add your Price IDs to paywall.html');
        return;
      }
      document.getElementById('terminalModalConfirm').disabled = true;
      document.getElementById('terminalModalConfirm').textContent = 'Loading...';
      try {
        const STRIPE_API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
          ? 'http://localhost:3001'
          : 'https://xpose-stripe-server.vercel.app';
        const response = await fetch(`${STRIPE_API_URL}/create-checkout-session`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            priceId: priceId,
            customerEmail: getUserEmail(),
            terminalModel: terminal // <-- FIXED: match backend param
          }),
        });
        if (!response.ok) {
          let bodyText = null;
          try { bodyText = await response.text(); } catch (e) { bodyText = '<unreadable>'; }
          console.error('Checkout error response:', response.status, response.statusText, bodyText);
          throw new Error(`Server responded ${response.status}: ${bodyText}`);
        }
        const data = await response.json();
        if (data && data.url) {
          window.location.href = data.url;
        } else {
          console.error('Invalid checkout payload from server:', data);
          throw new Error((data && data.error) || 'Failed to create checkout session (no url returned)');
        }
      } catch (error) {
        console.error('Checkout exception:', error);
        const msg = (error && error.message) ? error.message : 'Failed to start checkout. Please try again.';
        alert('Failed to start checkout: ' + msg);
        document.getElementById('terminalModalConfirm').disabled = false;
        document.getElementById('terminalModalConfirm').textContent = 'Confirm & Checkout';
      }
    };

    // Opt out - proceed without terminal
    document.getElementById('terminalOptOut').onclick = async function() {
      const plan = selectedPlan;
      if (!plan) {
        alert('Please select a plan.');
        return;
      }
      const priceId = PRICE_IDS[plan];
      if (!priceId || priceId.includes('REPLACE')) {
        alert('Stripe is not configured yet. Please add your Price IDs to paywall.html');
        return;
      }
      document.getElementById('terminalOptOut').disabled = true;
      document.getElementById('terminalOptOut').textContent = 'Loading...';
      try {
        const STRIPE_API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
          ? 'http://localhost:3001'
          : 'https://xpose-stripe-server.vercel.app';
        const response = await fetch(`${STRIPE_API_URL}/create-checkout-session`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            priceId: priceId,
            customerEmail: getUserEmail(),
            terminalModel: null // No terminal selected
          }),
        });
        if (!response.ok) {
          let bodyText = null;
          try { bodyText = await response.text(); } catch (e) { bodyText = '<unreadable>'; }
          console.error('Checkout error response:', response.status, response.statusText, bodyText);
          throw new Error(`Server responded ${response.status}: ${bodyText}`);
        }
        const data = await response.json();
        if (data && data.url) {
          window.location.href = data.url;
        } else {
          console.error('Invalid checkout payload from server:', data);
          throw new Error((data && data.error) || 'Failed to create checkout session (no url returned)');
        }
      } catch (error) {
        console.error('Checkout exception:', error);
        const msg = (error && error.message) ? error.message : 'Failed to start checkout. Please try again.';
        alert('Failed to start checkout: ' + msg);
        document.getElementById('terminalOptOut').disabled = false;
        document.getElementById('terminalOptOut').innerHTML = 'Opt out - I have my own terminal<br><span style="font-size:0.85rem;opacity:0.9;">(Start using immediately)</span>';
      }
    };
  </script>
</body>
</html>
