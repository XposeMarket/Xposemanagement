
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Upgrade Subscription | Xpose Management</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    body {
      background: linear-gradient(120deg, #f6f8ff 0%, #eaf3ff 100%);
      margin: 0;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      color: #222;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 40px 0 40px;
      background: #fff;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(8px);
      box-shadow: 0 2px 8px rgba(42,124,255,0.04);
    }
    .header-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.5rem;
      font-weight: 700;
      color: #2a7cff;
      text-decoration: none;
    }
    .header-nav {
      display: flex;
      align-items: center;
      gap: 28px;
      font-size: 1.08rem;
    }
    .header-nav a {
      color: #222;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .header-nav a:hover {
      color: #2a7cff;
    }
    .header-actions {
      display: flex;
      gap: 12px;
    }
    .btn-secondary {
      background: #fff;
      color: #2a7cff;
      border: 1.5px solid #e0e7ff;
      border-radius: 7px;
      padding: 12px 32px;
      font-size: 1.08rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(42,124,255,0.07);
      transition: border 0.2s;
    }
    .btn-secondary:hover {
      border-color: #2a7cff;
    }
    .pricing-main {
      max-width: 1100px;
      margin: 48px auto 0 auto;
      padding: 0 16px;
    }
    .pricing-title {
      font-size: 2.5rem;
      font-weight: 800;
      text-align: center;
      margin-bottom: 18px;
    }
    .pricing-desc {
      text-align: center;
      color: #4a5a6a;
      font-size: 1.18rem;
      margin-bottom: 38px;
    }
    .pricing-row {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(260px,1fr));
      gap: 32px;
      margin-bottom: 32px;
    }
    .pricing-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      padding: 32px 24px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .pricing-card.popular {
      border: 2px solid #2a7cff;
    }
    .pricing-card h3 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: #2a7cff;
    }
    .pricing-card .plan-type {
      color: #888;
      font-size: 1.05rem;
      margin-bottom: 6px;
    }
    .pricing-card .plan-price {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 8px;
    }
    .pricing-card ul {
      list-style: disc inside;
      padding: 0 0 0 18px;
      margin: 0 0 18px 0;
      color: #888;
      font-size: 1rem;
      text-align: left;
    }
    .pricing-card .popular-badge {
      background: #eaf3ff;
      color: #2a7cff;
      font-size: 0.95rem;
      padding: 2px 10px;
      border-radius: 12px;
      margin-left: 8px;
      font-weight: 600;
      display: inline-block;
    }
    .pricing-card .coming-soon-badge {
      background: #ffeaa7;
      color: #d63031;
      font-size: 0.95rem;
      padding: 2px 10px;
      border-radius: 12px;
      margin-left: 8px;
      font-weight: 600;
      display: inline-block;
    }
    .pricing-card.disabled {
      opacity: 0.7;
      position: relative;
    }
    .pricing-card.disabled::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 14px;
      pointer-events: none;
    }
    .pricing-card.disabled .plan-btn {
      background: #ccc;
      cursor: not-allowed;
      pointer-events: none;
    }
    .pricing-card .plan-btn {
      margin: 0 auto;
      display: inline-block;
      background: #2a7cff;
      color: #fff;
      border: none;
      border-radius: 7px;
      padding: 12px 32px;
      font-size: 1.08rem;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(42,124,255,0.10);
      transition: background 0.2s;
    }
    .pricing-card .plan-btn:hover {
      background: #195bb5;
    }
    .footer {
      margin-top: 80px;
      background: #f6f8ff;
      padding: 32px 0 16px 0;
      text-align: center;
      color: #7f5fff;
      font-size: 1.08rem;
    }
    .trial-note {
      text-align: center;
      color: #888;
      font-size: 1rem;
      margin-top: 32px;
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="index.html" class="header-logo">
      <img src="assets/XposeManagementCRMlogo.png" alt="CRM Official Logo" style="height:54px;vertical-align:middle;">
    </a>
    <nav class="header-nav">
      <a href="index.html">Home</a>
      <a href="features.html">Features</a>
      <a href="paywall.html">Pricing</a>
    </nav>
    <div class="header-actions">
      <a href="login.html"><button class="btn-secondary">Sign In</button></a>
    </div>
  </header>
  <main class="pricing-main">
    <div class="pricing-title">Choose Your Plan</div>
    <div class="pricing-desc">Simple, transparent pricing. Start with a 14-day free trial. Cancel anytime.</div>
    <div class="pricing-row">
      <div class="pricing-card">
        <h3>Single <span class="popular-badge">Available Now</span></h3>
        <div class="plan-type">1 Shop</div>
        <div class="plan-price">$99 <span style="font-size:1rem;font-weight:400;">/month</span></div>
        <ul>
          <li>All core features</li>
        </ul>
        <button class="plan-btn">Start Single</button>
      </div>
      <div class="pricing-card popular">
        <h3>Local <span class="popular-badge">Most Popular</span></h3>
        <div class="plan-type">1-3 Shops</div>
        <div class="plan-price">$149 <span style="font-size:1rem;font-weight:400;">/month</span></div>
        <ul>
          <li>All Core features</li>
          <li>Multi-shop management</li>
          <li><strong>1 month free Messaging</strong></li>
        </ul>
        <button class="plan-btn">Select Local</button>
      </div>
      <div class="pricing-card">
        <h3>Multi</h3>
        <div class="plan-type">1-6 Shops</div>
        <div class="plan-price">$199 <span style="font-size:1rem;font-weight:400;">/month</span></div>
        <ul>
          <li>All Core features</li>
          <li>Advanced multi-shop tools</li>
          <li>First to receive all updates (Beta Testings included)</li>
          <li><strong>1 month free Messaging</strong></li>
        </ul>
        <button class="plan-btn">Select Multi</button>
      </div>
    </div>
    <div class="trial-note">All plans come with a 14-day free trial. Cancel anytime free of charge.</div>
  </main>
  <footer class="footer" style="background:#f6f8ff;padding:32px 0 16px 0;text-align:center;color:#7f5fff;font-size:1.08rem;">
    <span>Â© 2025 Xpose Management</span>
    <div style="margin-top:18px;font-size:1.08rem;">
      <a href="faq.html" style="margin-right:18px;color:#2a7cff;font-weight:600;">FAQ</a>
      <a href="privacy.html" style="margin-right:18px;color:#2a7cff;font-weight:600;">Privacy Policy</a>
      <a href="terms.html" style="margin-right:18px;color:#2a7cff;font-weight:600;">Terms of Service</a>
      <a href="contact.html" style="color:#2a7cff;font-weight:600;">Contact/Support</a>
    </div>
  </footer>
  
  <script>
    // Stripe Price IDs - These are your actual Price IDs from Stripe Dashboard
    const PRICE_IDS = {
      single: 'price_1SX97Z4K55W1qqBCSwzYlDd6',
      local: 'price_1SX97b4K55W1qqBC7o7fJYUi',
      multi: 'price_1SX97d4K55W1qqBCcNM0eP00'
    };

    // Get user email if logged in
    function getUserEmail() {
      try {
        const session = JSON.parse(localStorage.getItem('xm_session') || '{}');
        const email = session.email || null;
        // Only return email if it's properly formatted (has @ and domain)
        if (email && email.includes('@') && email.includes('.')) {
          return email;
        }
        return null;
      } catch (e) {
        return null;
      }
    }

    // Handle plan button clicks
    document.querySelectorAll('.plan-btn').forEach((btn, index) => {
      btn.addEventListener('click', async () => {
        // Determine which plan was clicked
        let priceId;
        if (index === 0) priceId = PRICE_IDS.single;
        else if (index === 1) priceId = PRICE_IDS.local;
        else if (index === 2) priceId = PRICE_IDS.multi;

        if (!priceId || priceId.includes('REPLACE')) {
          alert('Stripe is not configured yet. Please add your Price IDs to paywall.html');
          return;
        }

        // Disable button and show loading
        btn.disabled = true;
        btn.textContent = 'Loading...';

        try {
          // Call backend to create checkout session
          const STRIPE_API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3001'
            : 'https://xpose-stripe-server.vercel.app';
          
          const response = await fetch(`${STRIPE_API_URL}/create-checkout-session`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              priceId: priceId,
              customerEmail: getUserEmail()
            }),
          });

          // If the network request succeeded but returned a non-2xx, capture body for debugging
          if (!response.ok) {
            let bodyText = null;
            try { bodyText = await response.text(); } catch (e) { bodyText = '<unreadable>'; }
            console.error('Checkout error response:', response.status, response.statusText, bodyText);
            throw new Error(`Server responded ${response.status}: ${bodyText}`);
          }

          const data = await response.json();

          if (data && data.url) {
            // Redirect to Stripe Checkout
            window.location.href = data.url;
          } else {
            console.error('Invalid checkout payload from server:', data);
            throw new Error((data && data.error) || 'Failed to create checkout session (no url returned)');
          }
        } catch (error) {
          console.error('Checkout exception:', error);
          // Show more detailed message to help debugging on mobile
          const msg = (error && error.message) ? error.message : 'Failed to start checkout. Please try again.';
          alert('Failed to start checkout: ' + msg);
          btn.disabled = false;
          btn.textContent = btn.textContent.replace('Loading...', 'Start ' + ['Single', 'Local', 'Multi'][index]);
        }
      });
    });
  </script>
</body>
</html>
