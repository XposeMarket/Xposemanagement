<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Profile</title><link rel="stylesheet" href="styles.css"></head><body>
<header class="top">
  <div class="container row top row">
    <a class="brand" href="dashboard.html" aria-label="Home" id="brandLink">
      <img id="headerLogo" src="assets/XposeManagementCRMlogo.png" alt="Logo">
    </a>
    <button id="menuToggle" class="menu-toggle" aria-label="Toggle menu"><span></span><span></span><span></span></button><nav id="mainNav">
      <a href="staff-portal.html" class="staff-only-nav" style="display:none">Staff Portal</a>
      <a href="dashboard.html" class="owner-nav">Dashboard</a>
      <a href="foreman-appointments.html" class="foreman-nav" style="display:none">Job Board</a>
      <a href="claim-board.html" class="" style="display:none">Claim Board</a>
      <a href="appointments.html" class="owner-nav">Appointments</a>
      <a href="jobs.html" class="owner-nav">Jobs</a>
      <a href="staff-jobs.html" class="staff-only-nav foreman-nav" style="display:none">My Jobs</a>
      <a href="messages.html" class="owner-nav">Messages</a>
      <a href="invoices.html" class="owner-nav">Invoices</a>
      <a href="customers.html" class="owner-nav">Customers</a>
      <a href="revenue.html" class="owner-nav">Revenue</a>
      <!-- Inventory link hidden for staff users -->
      <!-- <a href="inventory.html" class="owner-nav" id="inventoryNavLink" style="display:none">Inventory</a> -->
      <a href="settings.html" class="owner-nav">Settings</a>
      <a href="profile.html" class="active">Profile</a>
        <a href="#" id="mobileThemeToggle" class="mobile-nav-btn mobile-special">Theme</a>
        <a href="#" id="mobileLogoutBtn" class="mobile-nav-btn mobile-special">Logout</a>
    </nav>
    <div>
      <button id="themeToggle" class="btn" aria-label="Toggle theme">Theme</button>
      <button id="logoutBtn" class="btn" aria-label="Logout">Logout</button>
    </div>
  </div>
</header>
<main class="container profile-main">
  <div class="profile-flex">
    <div id="profileCardCol">
      <h1>Profile</h1>
      <div id="profileCard" class="card">
        <label>First name</label><input id="pfFirst">
        <label>Last name</label><input id="pfLast">
        <label>Email (read-only)</label><input id="pfEmail" disabled>
        <label>Role</label><input id="pfRole" disabled>
        <div class="profile-btn-row">
          <button id="pfSave" class="btn info">Save</button>
          <button id="changeEmailBtn" class="btn">Change Email</button>
          <button id="changePassBtn" class="btn">Change Password</button>
        </div>
        <p id="pfSaved" class="notice"></p>
      </div>
      <p id="pfSaved" class="notice"></p>
    </div>
    <aside id="themePanel" class="card">
      <h3>Theme Picker</h3>
      <div id="themeSwatches">
        <div class="theme-swatch" data-theme="light" title="Default">
          <div style="flex:1;background:#fff;"></div>
          <div style="flex:1;background:#fff;"></div>
        </div>
        <div class="theme-swatch" data-theme="theme-alt" title="Alt">
          <div style="flex:1;background:#eaf6fb;"></div>
          <div style="flex:1;background:#f7fafc;"></div>
        </div>
        <div class="theme-swatch" data-theme="theme-blue" title="Blue">
          <div style="flex:1;background:#e3f0fa;"></div>
          <div style="flex:1;background:#f3f8fd;"></div>
        </div>
        <div class="theme-swatch" data-theme="theme-bluegrey" title="Blue-Grey">
          <div style="flex:1;background:#e6eaf1;"></div>
          <div style="flex:1;background:#f4f6fa;"></div>
        </div>
        <div class="theme-swatch" data-theme="theme-dark" title="Dark">
          <div style="flex:1;background:#232834;"></div>
          <div style="flex:1;background:#181c23;"></div>
        </div>
      </div>
      <div class="theme-panel-note">Click a color to change theme</div>
    </aside>
  </div>
</main>
<div id="emailModal" class="card hidden" style="position:fixed;right:20px;bottom:20px;max-width:520px;z-index:50">
  <div class="toolbar" style="justify-content:space-between">
    <h3>Change Email</h3>
    <button id="closeEmail" class="btn">Close</button>
  </div>
  <label>New Email</label>
  <input id="newEmail" type="email" placeholder="name@example.com">
  <label>Current Password (re-auth)</label>
  <input id="curPassForEmail" type="password" placeholder="Current password">
  <div class="toolbar" style="margin-top:10px;justify-content:flex-end">
  <button id="saveEmail" class="btn info">Save</button>
  </div>
  <p id="emailNotice" class="notice"></p>
</div>

<!-- Change Password Modal -->
<div id="passModal" class="card hidden" style="position:fixed;right:20px;bottom:20px;max-width:520px;z-index:50">
  <div class="toolbar" style="justify-content:space-between">
    <h3>Change Password</h3>
    <button id="closePass" class="btn">Close</button>
  </div>
  <label>Current Password</label>
  <input id="curPass" type="password" placeholder="Current password">
  <div class="grid cols-2">
    <div>
      <label>New Password</label>
      <input id="newPass" type="password" placeholder="At least 6 characters">
    </div>
    <div>
      <label>Confirm New Password</label>
      <input id="confPass" type="password" placeholder="Repeat new password">
    </div>
  </div>
  <div class="toolbar" style="margin-top:10px;justify-content:flex-end">
  <button id="savePass" class="btn info">Save</button>
  </div>
  <p id="passNotice" class="notice"></p>
</div>
<footer class="container">Â© Xpose Management</footer><script src="vendor/supabase.umd.js"></script><script type="module" src="app.js"></script><script src="multi-tenant.js"></script>
<script type="module">
  // Hide owner-only navigation for staff members
  import { getSupabaseClient } from './helpers/supabase.js';
  
  async function setupStaffNavigation() {
    const supabase = getSupabaseClient();
    if (!supabase) return;
    try {
      const { data: { user: authUser } } = await supabase.auth.getUser();
      if (!authUser) return;
      // Get current shop from session
      let curShopId = null;
      try {
        curShopId = JSON.parse(localStorage.getItem('xm_session') || '{}').shopId || null;
      } catch (e) {}
      // Query shop_staff for this user and current shop
      let staffRow = null;
      if (curShopId) {
        const { data: staffRows } = await supabase
          .from('shop_staff')
          .select('*')
          .eq('auth_id', authUser.id)
          .eq('shop_id', curShopId)
          .limit(1);
        if (staffRows && staffRows.length > 0) staffRow = staffRows[0];
      }
      let role = staffRow?.role || (authUser.user_metadata?.role || '').toLowerCase();
      if (role === 'foreman') {
        // Foreman: always show dashboard, show staff portal if hourly
        document.querySelectorAll('.owner-nav').forEach(el => {
          if (el.getAttribute('href') === 'dashboard.html') {
            el.style.display = '';
          } else {
            el.style.display = 'none';
          }
        });
        if (staffRow && Number(staffRow.hourly_rate) > 0) {
          document.querySelectorAll('.staff-only-nav').forEach(el => {
            el.style.display = '';
          });
          const brandLink = document.getElementById('brandLink');
          if (brandLink) brandLink.href = 'staff-portal.html';
          console.log('ðŸ‘· Foreman (hourly) - dashboard and staff portal shown');
        } else {
          document.querySelectorAll('.staff-only-nav').forEach(el => {
            el.style.display = 'none';
          });
          const brandLink = document.getElementById('brandLink');
          if (brandLink) brandLink.href = 'dashboard.html';
          console.log('ðŸ‘· Foreman (flat) - dashboard shown, staff portal hidden');
        }
      } else if (staffRow && Number(staffRow.hourly_rate) > 0) {
        // Hourly staff for this shop: show staff portal
        document.querySelectorAll('.owner-nav').forEach(el => {
          el.style.display = 'none';
        });
        document.querySelectorAll('.staff-only-nav').forEach(el => {
          el.style.display = '';
        });
        const brandLink = document.getElementById('brandLink');
        if (brandLink) brandLink.href = 'staff-portal.html';
        console.log('ðŸ‘¤ Hourly staff for this shop - staff portal shown');
      } else {
        // Not hourly for this shop: hide staff portal
        document.querySelectorAll('.owner-nav').forEach(el => {
          el.style.display = '';
        });
        document.querySelectorAll('.staff-only-nav').forEach(el => {
          el.style.display = 'none';
        });
        const brandLink = document.getElementById('brandLink');
        if (brandLink) brandLink.href = 'dashboard.html';
        if (staffRow) {
          console.log('ðŸ‘¤ Flat-rate staff for this shop - staff portal hidden');
        } else {
          console.log('ðŸ‘‘ Owner/admin or not staff for this shop - staff portal hidden');
        }
      }
    } catch (err) {
      console.error('Error setting up staff navigation:', err);
    }
  }
  // Run on page load
  setupStaffNavigation();
</script>
</body></html>
